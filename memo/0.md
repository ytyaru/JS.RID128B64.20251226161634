# ID

種類|概要
----|----
RID|分散システムで使用するID。128bits等任意サイズの乱数をBase64URLなど文脈で使用可能な文字だけで構成された文字列。
IID|中央システムで使用するID。ソート可能な連番。（0から始まる整数であり+1する）
TID|中央システムで使用するID。ソート可能な非連番（先頭bitsが日時(Time)、後方bitsが乱数）。RDBMSファイルB木構造やURLで共用可だが日時が表出してしまう。

形式|概要
----|----
コマンド|CUIコマンド形式で文字列を返す
関数|JS関数で文字列を返す
クラス|String,BigInt,Uint8Array形式を返す

## コマンド

```sh
$ rid 
-b --bits  128等8以上な2の冪乗数（初期値128）
-B --base  使用字種数（初期値64)
  2〜64   6bit以下ずつURLセーフ文字に変換する(字数=bits/6, 字bits=bits*(4/3))
  256     8bitずつUnicode点字(4Byte)に変換する(字数=bits/8, 字bits=bits*4)
  65565   16bitずつUnicode2Byte文字に変換する(字数=bits/16, 字bits=bits*1)
```

## 関数

```javascript
rid(base=64, bits=128); // ID文字列を返す
iid(next=0n, base=64); // ID文字列を返す
```

## クラス

```javascript
class RID {...}
const rid = new RID(base=64, bits=128);
rid.str; // 文字列 ...
rid.int; // BigInt ...
rid.u8a; // Uint8Array ...
rid.full; // 文字列 rid128b64-... bitsやbaseをヘッダとして記述する
RID.convert(value, base, bits); // 他のBaseやbitsにした時のRIDインスタンスを返す

class IID {...}
const iid = new IID(next=0n, base=64);
iid.next(); // 次に進める
iid.int; // BigIntで現在値を取得する
iid.str; // Stringで現在値を取得する
iid.u8a; // Uint8Arrayで現在値を取得する
IID.convert(value, base); // 他のBaseやbitsにした時のIIDインスタンスを返す
```

## Base戦略

Base|ID字数|ID字bits|概要
----|------|--------|----
65565|bits/16|bits*1|IDデータ量最小だがUnicode2バイト文字なので可読性が悪く非URLセーフ
256|bits/8|bits*4|ID字数は少ないがデータ量最大で非URLセーフ
64|bits/6|bits/6|URLセーフで高速計算可だがIDの字数やbitsは増加する
62|bits/5.9|bits/5.9|記号セーフだがIDの字数やbitsは増加する
36|bits/5.1|bits/5.1|英字大小セーフだがIDの字数やbitsは増加する
32|bits/5|bits/5|英字大小セーフだがIDの字数やbitsは増加する
16|bits/4|bits/4|英字大小セーフで高速計算可だがIDの字数やbitsは増加する
10|bits/3.3|bits/3.3|英字セーフだがIDの字数やbitsは増加する

```javascript
const IdCharNum = bits / Math.log2(base);
```

## 日時バイナリ構成

項目|bits|最小|別|別|別
----|----|----|--|--|--
year|16|16|32|32|32|32
month|8|4|4|8|8
days|8|5|5|8|8
hours|8|5|5|8|8
minutes|8|6|6|8|8
seconds|8|6|6|8|8
millSec|0|0|0|0|8
乱数|70|84|68|56|48

　56bitの乱数が衝突する確率。誕生日のパラドクスにあるように、生成数が増えると急激に衝突率が増加する。n個生成した時に一致する確率。約3億1665万個生成した時、衝突率50%を超える。

```mathml
\(n\approx \sqrt{2^{56}\times \ln (2)}\approx 1.18\times \sqrt{2^{56}}=1.18\times 2^{28}\)
```

　同一システム上において世界中の人々がIDを同時生成しうるとして、一秒間に3億個生成すれば50%の確率で一致する。おそらくそんなことは起きない。

